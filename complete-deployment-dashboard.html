<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ataraxia Complete Deployment Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .deployment-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .deployment-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 24px;
        }

        .local-icon {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .cloud-icon {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .card-subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        .service-selector {
            margin-bottom: 20px;
        }

        .service-selector label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .service-selector select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }

        .deploy-button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .local-deploy {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
        }

        .local-deploy:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
        }

        .cloud-deploy {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .cloud-deploy:hover {
            background: linear-gradient(135deg, #1976D2, #1565C0);
        }

        .stop-button {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            color: white;
        }

        .stop-button:hover {
            background: linear-gradient(135deg, #d32f2f, #c62828);
        }

        .status-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .status-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .status-label {
            color: #666;
            font-size: 0.9rem;
        }

        .logs-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .logs-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .logs-container {
            background: #1e1e1e;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-info { color: #4CAF50; }
        .log-warning { color: #FF9800; }
        .log-error { color: #f44336; }
        .log-success { color: #8BC34A; }

        .api-test-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 30px;
        }

        .api-endpoints {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .api-endpoint {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .api-endpoint:hover {
            border-color: #2196F3;
        }

        .api-method {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 10px;
            min-width: 50px;
            text-align: center;
        }

        .method-get { background: #4CAF50; color: white; }
        .method-post { background: #2196F3; color: white; }
        .method-put { background: #FF9800; color: white; }
        .method-delete { background: #f44336; color: white; }

        .api-status {
            margin-left: auto;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }

        .api-status.success { background: #4CAF50; }
        .api-status.error { background: #f44336; }
        .api-status.testing { background: #FF9800; }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .connected {
            background: #4CAF50;
            color: white;
        }

        .disconnected {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .status-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="connection-status" id="connectionStatus">Connecting...</div>
    
    <div class="container">
        <div class="header">
            <h1>üöÄ Ataraxia Deployment Dashboard</h1>
            <p>Complete deployment system for local development and AWS CDK</p>
        </div>

        <div class="dashboard-grid">
            <!-- Local Development Card -->
            <div class="deployment-card">
                <div class="card-header">
                    <div class="card-icon local-icon">üíª</div>
                    <div>
                        <div class="card-title">Local Development</div>
                        <div class="card-subtitle">Run services locally for development</div>
                    </div>
                </div>

                <div class="service-selector">
                    <label for="localService">Select Service:</label>
                    <select id="localService">
                        <option value="all">All Services (Full API Server)</option>
                        <option value="therapist">Therapist Service Only</option>
                        <option value="auth">Authentication Service Only</option>
                        <option value="client">Client Service Only</option>
                        <option value="verification">Verification Service Only</option>
                        <option value="api-explorer">API Explorer Only</option>
                    </select>
                </div>

                <button class="deploy-button local-deploy" onclick="startLocalDeployment()">
                    üöÄ Start Local Development
                </button>
                <button class="deploy-button stop-button" onclick="stopLocalDeployment()">
                    ‚èπÔ∏è Stop Local Services
                </button>
            </div>

            <!-- AWS CDK Card -->
            <div class="deployment-card">
                <div class="card-header">
                    <div class="card-icon cloud-icon">‚òÅÔ∏è</div>
                    <div>
                        <div class="card-title">AWS CDK Deployment</div>
                        <div class="card-subtitle">Deploy to AWS Lambda & API Gateway</div>
                    </div>
                </div>

                <div class="service-selector">
                    <label for="cloudService">Select Service:</label>
                    <select id="cloudService">
                        <option value="all">Complete Stack (All Services)</option>
                        <option value="therapist">Therapist Service Only</option>
                        <option value="auth">Authentication Only</option>
                        <option value="client">Client Service Only</option>
                        <option value="verification">Verification Only</option>
                        <option value="infrastructure">Infrastructure Only</option>
                    </select>
                </div>

                <button class="deploy-button cloud-deploy" onclick="startCloudDeployment()">
                    ‚òÅÔ∏è Deploy to AWS
                </button>
                <button class="deploy-button stop-button" onclick="stopCloudDeployment()">
                    ‚èπÔ∏è Stop Deployment
                </button>
            </div>
        </div>

        <!-- Status Section -->
        <div class="status-section">
            <h2>üìä Deployment Status</h2>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="localStatus">Stopped</div>
                    <div class="status-label">Local Services</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="cloudStatus">Not Deployed</div>
                    <div class="status-label">AWS Deployment</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="databaseStatus">Checking...</div>
                    <div class="status-label">Database</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="apiStatus">Unknown</div>
                    <div class="status-label">API Health</div>
                </div>
            </div>
        </div>

        <!-- Logs Section -->
        <div class="logs-section">
            <div class="logs-header">
                <h2>üìù Deployment Logs</h2>
                <button onclick="clearLogs()" style="padding: 8px 15px; border: none; border-radius: 5px; background: #f44336; color: white; cursor: pointer;">Clear Logs</button>
            </div>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry log-info">üöÄ Deployment dashboard initialized</div>
                <div class="log-entry log-info">üì° Connecting to deployment server...</div>
            </div>
        </div>

        <!-- API Testing Section -->
        <div class="api-test-section">
            <h2>üß™ API Endpoint Testing</h2>
            <div style="margin-bottom: 20px;">
                <button onclick="testApiEndpoints()" style="padding: 12px 20px; border: none; border-radius: 8px; background: #2196F3; color: white; cursor: pointer; font-weight: 600;">
                    üß™ Test All API Endpoints
                </button>
                <span style="margin-left: 15px; color: #666;">Test the deployed API endpoints</span>
            </div>
            <div class="api-endpoints" id="apiEndpoints">
                <!-- API endpoints will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE_URL = 'http://localhost:3012';
        const WS_URL = 'ws://localhost:3012';
        
        // State
        let ws = null;
        let deploymentState = {
            local: { status: 'stopped', service: 'all' },
            cloud: { status: 'not_deployed', service: 'all' },
            database: { status: 'unknown' },
            api: { status: 'unknown', endpoints: [] }
        };

        // WebSocket connection
        function connectWebSocket() {
            try {
                ws = new WebSocket(WS_URL);
                
                ws.onopen = function() {
                    updateConnectionStatus(true);
                    addLog('success', 'üì° Connected to deployment server');
                };
                
                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        addLog('warning', 'Received invalid message from server');
                    }
                };
                
                ws.onclose = function() {
                    updateConnectionStatus(false);
                    addLog('warning', 'üì° Disconnected from deployment server');
                    // Attempt to reconnect after 3 seconds
                    setTimeout(connectWebSocket, 3000);
                };
                
                ws.onerror = function(error) {
                    updateConnectionStatus(false);
                    addLog('error', '‚ùå WebSocket connection error');
                };
            } catch (error) {
                updateConnectionStatus(false);
                addLog('error', '‚ùå Failed to connect to deployment server');
                // Attempt to reconnect after 5 seconds
                setTimeout(connectWebSocket, 5000);
            }
        }

        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'log':
                    addLog(data.level || 'info', data.message);
                    break;
                case 'status':
                    updateDeploymentStatus(data.status);
                    break;
                case 'api_test':
                    updateApiEndpointStatus(data.endpoint, data.status);
                    break;
                default:
                    console.log('Unknown message type:', data.type);
            }
        }

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.textContent = 'üü¢ Connected';
                statusEl.className = 'connection-status connected';
            } else {
                statusEl.textContent = 'üî¥ Disconnected';
                statusEl.className = 'connection-status disconnected';
            }
        }

        function updateDeploymentStatus(status) {
            if (status.local) {
                document.getElementById('localStatus').textContent = status.local;
                deploymentState.local.status = status.local;
            }
            if (status.cloud) {
                document.getElementById('cloudStatus').textContent = status.cloud;
                deploymentState.cloud.status = status.cloud;
            }
            if (status.database) {
                document.getElementById('databaseStatus').textContent = status.database;
                deploymentState.database.status = status.database;
            }
            if (status.api) {
                document.getElementById('apiStatus').textContent = status.api;
                deploymentState.api.status = status.api;
            }
        }

        // Deployment functions
        async function startLocalDeployment() {
            const service = document.getElementById('localService').value;
            addLog('info', `üöÄ Starting local deployment for: ${service}`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/deployment/local/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ service })
                });
                
                const result = await response.json();
                if (result.success) {
                    addLog('success', `‚úÖ Local deployment started successfully on port ${result.port}`);
                } else {
                    addLog('error', `‚ùå Local deployment failed: ${result.message}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Failed to start local deployment: ${error.message}`);
            }
        }

        async function stopLocalDeployment() {
            addLog('info', '‚èπÔ∏è Stopping local services...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/deployment/local/stop`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (result.success) {
                    addLog('success', '‚úÖ Local services stopped');
                } else {
                    addLog('error', `‚ùå Failed to stop local services: ${result.message}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Failed to stop local services: ${error.message}`);
            }
        }

        async function startCloudDeployment() {
            const service = document.getElementById('cloudService').value;
            addLog('info', `‚òÅÔ∏è Starting AWS CDK deployment for: ${service}`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/deployment/cloud/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ service, environment: 'dev' })
                });
                
                const result = await response.json();
                if (result.success) {
                    addLog('success', `‚úÖ AWS CDK deployment started (${result.deploymentId})`);
                } else {
                    addLog('error', `‚ùå AWS deployment failed: ${result.message}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Failed to start AWS deployment: ${error.message}`);
            }
        }

        async function stopCloudDeployment() {
            addLog('info', '‚èπÔ∏è Stopping AWS deployment...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/deployment/cloud/stop`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                if (result.success) {
                    addLog('success', '‚úÖ AWS deployment stopped');
                } else {
                    addLog('error', `‚ùå Failed to stop AWS deployment: ${result.message}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Failed to stop AWS deployment: ${error.message}`);
            }
        }

        async function testApiEndpoints() {
            addLog('info', 'üß™ Starting API endpoint testing...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/test-endpoints`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const result = await response.json();
                if (result.success) {
                    addLog('success', `‚úÖ API testing completed: ${result.results.filter(r => r.success).length}/${result.results.length} passed`);
                    updateApiEndpoints(result.results);
                } else {
                    addLog('error', `‚ùå API testing failed: ${result.message}`);
                }
            } catch (error) {
                addLog('error', `‚ùå Failed to test API endpoints: ${error.message}`);
            }
        }

        // Utility functions
        function addLog(level, message) {
            const logsContainer = document.getElementById('logsContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${level}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logsContainer').innerHTML = '';
            addLog('info', 'üìù Logs cleared');
        }

        function initializeApiEndpoints() {
            const endpoints = [
                { method: 'GET', path: '/api/therapist', description: 'List therapists' },
                { method: 'GET', path: '/api/therapist/search', description: 'Search therapists' },
                { method: 'GET', path: '/api/therapist/{id}', description: 'Get therapist by ID' },
                { method: 'POST', path: '/api/auth/login', description: 'Authentication' },
                { method: 'GET', path: '/api/verification/pending', description: 'Pending verifications' }
            ];

            const container = document.getElementById('apiEndpoints');
            container.innerHTML = '';

            endpoints.forEach((endpoint, index) => {
                const endpointEl = document.createElement('div');
                endpointEl.className = 'api-endpoint';
                endpointEl.innerHTML = `
                    <span class="api-method method-${endpoint.method.toLowerCase()}">${endpoint.method}</span>
                    <span>${endpoint.path}</span>
                    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">${endpoint.description}</span>
                    <div class="api-status" id="endpoint-${index}"></div>
                `;
                container.appendChild(endpointEl);
            });
        }

        function updateApiEndpointStatus(endpointIndex, status) {
            const statusEl = document.getElementById(`endpoint-${endpointIndex}`);
            if (statusEl) {
                statusEl.className = `api-status ${status}`;
            }
        }

        function updateApiEndpoints(results) {
            const container = document.getElementById('apiEndpoints');
            container.innerHTML = '';

            results.forEach((result, index) => {
                const endpointEl = document.createElement('div');
                endpointEl.className = 'api-endpoint';
                
                const statusClass = result.success ? 'success' : 'error';
                const statusText = result.success ? `‚úì ${result.status}` : `‚úó ${result.status || 'Error'}`;
                const responseTime = result.responseTime ? `${result.responseTime}ms` : 'N/A';
                
                endpointEl.innerHTML = `
                    <span class="api-method method-${result.method.toLowerCase()}">${result.method}</span>
                    <span>${result.path}</span>
                    <span style="margin-left: 10px; color: #666; font-size: 0.9em;">${result.description}</span>
                    <span style="margin-left: auto; font-size: 0.8em; color: #999;">${responseTime}</span>
                    <div class="api-status ${statusClass}" title="${statusText}"></div>
                `;
                container.appendChild(endpointEl);
            });
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', 'üöÄ Initializing deployment dashboard...');
            initializeApiEndpoints();
            connectWebSocket();
            
            // Check initial status
            setTimeout(checkInitialStatus, 1000);
        });

        async function checkInitialStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/status`);
                const status = await response.json();
                updateDeploymentStatus(status);
                addLog('success', '‚úÖ Initial status loaded');
            } catch (error) {
                addLog('warning', '‚ö†Ô∏è Could not load initial status');
            }
        }
    </script>
</body>
</html>